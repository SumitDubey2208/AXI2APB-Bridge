echo "Setting up work directory"
vlib work

vlog ${QUESTA_MVC_HOME}/include/questa_mvc_svapi.svh \
    +incdir+${QUESTA_MVC_HOME}/questa_mvc_src/sv +define+MAP_PROT_ATTR ${QUESTA_MVC_HOME}/questa_mvc_src/sv/mvc_pkg.sv \
    +incdir+${QUESTA_MVC_HOME}/questa_mvc_src/sv +incdir+${QUESTA_MVC_HOME}/questa_mvc_src/sv/axi4 ${QUESTA_MVC_HOME}/questa_mvc_src/sv/axi4/mgc_axi4_v1_0_pkg.sv \
    +incdir+${QUESTA_MVC_HOME}/questa_mvc_src/sv +incdir+${QUESTA_MVC_HOME}/questa_mvc_src/sv/apb3 ${QUESTA_MVC_HOME}/questa_mvc_src/sv/apb3/mgc_apb3_v1_0_pkg.sv \
    +incdir+../config_policies ../config_policies/top_params_pkg.sv \
    top_pkg.sv \
    +incdir+${QUESTA_MVC_HOME}/questa_mvc_src/sv/axi4/modules ${QUESTA_MVC_HOME}/questa_mvc_src/sv/axi4/modules/axi4_master.sv \
    +incdir+${QUESTA_MVC_HOME}/questa_mvc_src/sv/apb3/modules ${QUESTA_MVC_HOME}/questa_mvc_src/sv/apb3/modules/apb_slave.sv \
    /home/intern2/axi_2apb_bridge/axi2apb_bridge.sv \
    default_clk_gen.sv \
    default_reset_gen.sv \
    hdl_top.sv \
    hvl_top.sv

echo "Optimisation step"
vopt -o top_opt hdl_top hvl_top

echo "Running test"
vsim -c -mvchome ${QUESTA_MVC_HOME} top_opt +nowarnTSCALE -t 1ns -do "run -all; quit" +UVM_TESTNAME=top_test_base +SEQ=top_example_vseq
